window.batch=new function(){var a,b,c,d,e,f,g,h;return g=function(a){return"function"==typeof a},f=Array.isArray||function(a){return"[object Array]"===toString.call(a)},h=function(a){return a===Object(a)},e=Object.keys||function(a){var b,c,d,e;if(!h(a))throw new TypeError("Invalid object");for(c=[],d=0,e=a.length;e>d;d++)b=a[d],a.hasOwnProperty(b)&&(c[c.length]=b);return c},d={stack_limit:5e3,block_limit:50},a=function(a,b){return this.stack_depth=0,this._stack_limit=b||d.stack_limit,this._start_time=+new Date,this._limit=a||d.block_limit},a.prototype={next:function(a){var b,c,d;return b=+new Date,c=this._limit<b-this._start_time,d=this._stack_limit<=this.stack_depth,c||d?(this._start_time=b,this.stack_depth=0,setTimeout(a,0)):(this.stack_depth++,a())}},b=function(b,c){return this.iterator=b,this.balancer=c,this.state={},this._handlers=[],this.balancer||(this.balancer=new a),this},b.prototype={_call_complete_handlers:function(){var a,b,c=this;return 0<this._handlers.length?(a=this._handlers.shift(),b=a(this.result,this.state),void 0!==b&&(this.result=b),this.balancer.next(function(){return c._call_complete_handlers()})):void 0},start:function(a){var b,c=this;return this._iteration?this.state.is_complete?this._call_complete_handlers():this.balancer.next(this._iteration):(this.data=a,this.is_array_data=f(this.data),b=this.is_data_array||h(this.data)?e(this.data):[],this._iteration=g(this.iterator)?function(){var a,d;return c.state.is_wait?!1:0===b.length||c.state.is_complete?(c.state.is_complete=!0,c._call_complete_handlers()):(a=b.shift(),c.is_array_data&&(a=+a),d=c.iterator(c.data[a],a,c),void 0!==d&&(c.result||(c.result=c.is_array_data?[]:{}),c.result[a]=d),c.balancer.next(c._iteration))}:function(){return c.state.is_complete=!0,c.result=c.data,c._call_complete_handlers()},this.balancer.next(this._iteration))},stop:function(){return this.state.is_complete=!0},pause:function(){return this.state.is_wait=!0},resume:function(){return this.state.is_wait=!1,this.start()},on_complete:function(a){return g(a)&&(this._handlers.push(a),this.state.is_complete)?this._call_complete_handlers():void 0}},c=function(c){return this._last_flow=new b,this.current_flow=this._last_flow,this._last_flow.start(c||[]),this._balancer=new a,this},c.prototype={_push_flow:function(a){var c,d=this;return c=new b(a.iterator,this._balancer),c.on_complete(a.complete),this._last_flow.on_complete(function(a){return d.current_flow=c,c.start(a)}),this._last_flow=c,this},use:function(a){return this._push_flow({complete:function(){return a}}),this},each:function(a){return this._push_flow({iterator:function(b,c,d){var e;return e=a(b,c,d),e===!1?d.stop():void 0}}),this},map:function(a){return this._push_flow({iterator:a})},reduce:function(a,b){var c;return c=b,this._push_flow({iterator:function(b,d,e){var f;return f=a(b,d,c,e),void 0!==f?c=f:void 0},complete:function(){return c}}),this},select:function(a){var b;return b=[],this._push_flow({iterator:function(c,d,e){return a(c,d,e)===!0?b.push(c):void 0},complete:function(){return b}}),this},find:function(a){var b;return b=void 0,this._push_flow({iterator:function(c,d,e){return a(c,d,e)===!0?(b=c,e.stop()):void 0},complete:function(){return b}}),this},next:function(a){return this._last_flow.on_complete(function(b){return a(b),void 0}),this}},function(a){return new c(a)}};var ui_guid_generator;ui_guid_generator=new function(){var a;return a=function(){return Math.floor(65536*Math.random()).toString(16)},function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}};var mangra;mangra=new function(){var a,b,c;return c=batch(),a=function(a){return this.name=a,this._id=ui_guid_generator(),this._handlers=[],this._last_params=null,this},a.prototype={_handlers_caller:function(a){var b,d,e=this;return a=(a||this._handlers).concat([]),d={name:this.name},b="[object Array]"===toString.call(this._last_params)?this._last_params:[this._last_params],b.push(d),c.use(a).each(function(a,c){var d;return null==(null!=(d=a.event_data)?d[e._id]:void 0)?(e._handlers.splice(c,1),delete a.event_data[e._id]):a.apply(a.event_data[e._id].context,b)})},on:function(a,b,c){return a.event_data=a.event_data||{},a.event_data[this._id]=a.event_data[this._id]||{},a.event_data[this._id].context=b||a.event_data[this._id].context,a.event_data[this._id].options=c||a.event_data[this._id].options,a.event_data.id=a.event_data.id||ui_guid_generator(),this._handlers.push(a),null!=c&&null!=c.recall&&null!=this._last_params&&this._handlers_caller([a]),this},off:function(a){return a.event_data&&a.event_data[this._id]&&delete a.event_data[this._id],this},fire:function(a){return this._last_params=a,this._handlers_caller()}},b=function(a){return this.name=a,this.list={},this},b.prototype={list:{},init:function(a){var b;return b=this.sprout(),a.fire=function(){return b.fire.apply(b,arguments)},a.once=function(){return b.once.apply(b,arguments)},a.on=function(){return b.on.apply(b,arguments)},a.off=function(){return b.off.apply(b,arguments)},a},sprout:function(a){var c;return this[a]?this[a]instanceof b?this[a]:!1:(c=new b(a),a&&(this[a]=c),c)},create:function(b){return b?null!=this.list[b]?this.list[b]:this.list[b]=new a(b):new a},forget:function(a){return a?(delete this.list[a],this):void 0},once:function(a,b,c,d){var e,f,g=this;return e=this,f=function(){return g.off(a,b),g.off(a,f)},this.on(a,b,c,d),this.on(a,f),f},on:function(a,b,c,d){var e,f,g,h,i=this;for(f=a.split(/\s*,\s*/),g=0,h=f.length;h>g;g++)e=f[g],this.create(e).on(b,c,d);return function(){var a,c,d;for(d=[],a=0,c=f.length;c>a;a++)e=f[a],d.push(i.off(e,b));return d}},off:function(a,b){var c=this;return this.list[a]&&this.list[a].off(b),function(d,e){return c.on(a,b,d,e)}},wait:function(a,b,c,d){var e,f,g,h;return f=a.split(/\s*,\s*/).sort(),g=[],e={},h=function(){var a;return a=arguments[arguments.length-1],e[a.name]?(e[a.name]=arguments,void 0):(e[a.name]=arguments,g.push(a.name),g.length===f.length&&g.sort().join(" ")===f.join(" ")?b.call(c,e):void 0)},this.on(a,h,c,d)},fire:function(a,b){return this.create(a).fire(b)}},new b("mangra")};