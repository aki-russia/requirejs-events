window.batch=new function(){var a,b,c,d,e,f,g,h;return g=function(a){return"function"==typeof a},f=Array.isArray||function(a){return"[object Array]"===toString.call(a)},h=function(a){return a===Object(a)},e=Object.keys||function(a){var b,c,d,e;if(!h(a))throw new TypeError("Invalid object");for(c=[],d=0,e=a.length;e>d;d++)b=a[d],a.hasOwnProperty(b)&&(c[c.length]=b);return c},d={stack_limit:5e3,block_limit:50},a=function(a,b){return this.stack_depth=0,this._stack_limit=b||d.stack_limit,this._start_time=+new Date,this._limit=a||d.block_limit},a.prototype={next:function(a){var b,c,d;return b=+new Date,c=this._limit<b-this._start_time,d=this._stack_limit<=this.stack_depth,c||d?(this._start_time=b,this.stack_depth=0,setTimeout(a,0)):(this.stack_depth++,a())}},b=function(b,c){return this.iterator=b,this.balancer=c,this.state={},this._handlers=[],this.balancer||(this.balancer=new a),this},b.prototype={_call_complete_handlers:function(){var a,b,c=this;return 0<this._handlers.length?(a=this._handlers.shift(),b=a(this.result,this.state),void 0!==b&&(this.result=b),this.balancer.next(function(){return c._call_complete_handlers()})):void 0},start:function(a){var b,c=this;return this._iteration?this.state.is_complete?this._call_complete_handlers():this.balancer.next(this._iteration):(this.data=a,this.is_array_data=f(this.data),b=this.is_data_array||h(this.data)?e(this.data):[],this._iteration=g(this.iterator)?function(){var a,d;return c.state.is_wait?!1:0===b.length||c.state.is_complete?(c.state.is_complete=!0,c._call_complete_handlers()):(a=b.shift(),c.is_array_data&&(a=+a),d=c.iterator(c.data[a],a,c),void 0!==d&&(c.result||(c.result=c.is_array_data?[]:{}),c.result[a]=d),c.balancer.next(c._iteration))}:function(){return c.state.is_complete=!0,c.result=c.data,c._call_complete_handlers()},this.balancer.next(this._iteration))},stop:function(){return this.state.is_complete=!0},pause:function(){return this.state.is_wait=!0},resume:function(){return this.state.is_wait=!1,this.start()},on_complete:function(a){return g(a)&&(this._handlers.push(a),this.state.is_complete)?this._call_complete_handlers():void 0}},c=function(c){return this.current_flow=new b,this.current_flow.start(c||[]),this._balancer=new a,this},c.prototype={_push:function(a){var c;return c=new b(a.iterator,this._balancer),c.on_complete(a.complete),this.current_flow.on_complete(function(a){return c.start(a)}),this.current_flow=c,this},stop:function(){return this.current_flow.stop(),this},use:function(a){return this._push({complete:function(){return a}}),this},each:function(a){return this._push({iterator:function(b,c,d){var e;return e=a(b,c,d),e===!1?d.stop():void 0}}),this},map:function(a){return this._push({iterator:a})},reduce:function(a,b){var c;return c=b,this._push({iterator:function(b,d,e){var f;return f=a(b,d,c,e),void 0!==f?c=f:void 0},complete:function(){return c}}),this},find:function(a){var b;return b=void 0,this._push({iterator:function(c,d,e){return a(c,d,e)?(b=c,e.stop()):void 0},complete:function(){return b}}),this},next:function(a){return this.current_flow.on_complete(function(b){return a(b),void 0}),this}},function(a){return new c(a)}};